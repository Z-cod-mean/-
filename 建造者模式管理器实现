#include "3.builder.h"

#include <imgui.h>

using namespace _BuilderPattern;

//将所有部位默认设置为0
static int type_weapon = 0, type_body = 0, type_hat = 0;

//自定义武器（使用switch根据用户的选择创建武器）
//加载图片集工具atlas
void CustomChickenBuilder::init_weapon()
{
	//删除上一个图片

  //请继续建造
}

//自定义身体
void CustomChickenBuilder::init_body()
{
//删除上一个图片

  //请继续建造
}

//自定义头盔
void CustomChickenBuilder::init_hat()
{
//删除上一个图片

  //请继续建造
}

//将以上客户选择集合到建造函数中
Chicken* CustomChickenBuilder::build()
{
	Chicken* chicken = new Chicken();
  //实现鸡类里的三个部位引用上面的图片

  //请继续建造

	//建造完返回数据
}

BuilderPattern::BuilderPattern(SDL_Renderer* renderer)
{
	delete chicken;

	texture_target = SDL_CreateTexture(renderer, SDL_PIXELFORMAT_ARGB8888, SDL_TEXTUREACCESS_TARGET, 332, 296);
}

BuilderPattern::~BuilderPattern()
{
	SDL_DestroyTexture(texture_target);
}

//IMgui界面实现，未来学习
void BuilderPattern::on_update(float delta)
{
	if (chicken) 
		chicken->on_update(delta);

	ImGui::BeginGroup();
	ImGui::TextUnformatted(u8"武器：");				ImGui::SameLine();
	ImGui::RadioButton(u8"叉子", &type_weapon, 0);	ImGui::SameLine();
	ImGui::RadioButton(u8"盘子", &type_weapon, 1);	ImGui::SameLine();
	ImGui::RadioButton(u8"汤匙", &type_weapon, 2);

	ImGui::TextUnformatted(u8"身体：");				ImGui::SameLine();
	ImGui::RadioButton(u8"棕色", &type_body, 0);		ImGui::SameLine();
	ImGui::RadioButton(u8"红色", &type_body, 1);		ImGui::SameLine();
	ImGui::RadioButton(u8"白色", &type_body, 2);	

	ImGui::TextUnformatted(u8"帽子：");				ImGui::SameLine();
	ImGui::RadioButton(u8"皇冠", &type_hat, 0);		ImGui::SameLine();
	ImGui::RadioButton(u8"绿帽", &type_hat, 1);		ImGui::SameLine();
	ImGui::RadioButton(u8"草帽", &type_hat, 2);
	ImGui::EndGroup();

	ImGui::SameLine();

	ImGui::BeginGroup();
	if (ImGui::Button(u8"生成伊丽莎白鸡", {ImGui::GetContentRegionAvail().x / 2, 35}))
	{
		elizabeth_chicken_builder.init_weapon();
		elizabeth_chicken_builder.init_body();
		elizabeth_chicken_builder.init_hat();
		delete chicken; chicken = elizabeth_chicken_builder.build();
	}
	ImGui::SameLine();
	if (ImGui::Button(u8"生成绿帽吮指鸡", { ImGui::GetContentRegionAvail().x, 35 }))
	{
		green_hat_original_recipe_chicken_builder.init_weapon();
		green_hat_original_recipe_chicken_builder.init_body();
		green_hat_original_recipe_chicken_builder.init_hat();
		delete chicken; chicken = green_hat_original_recipe_chicken_builder.build();
	}
	if (ImGui::Button(u8"点击生成你自定义的鸡吧！", { ImGui::GetContentRegionAvail().x, 40 }))
	{
		custom_chicken_builder.init_weapon();
		custom_chicken_builder.init_body();
		custom_chicken_builder.init_hat();
		delete chicken; chicken = custom_chicken_builder.build();
	}
	ImGui::EndGroup();

	ImGui::BeginChild("chicken_result", ImGui::GetContentRegionAvail(), ImGuiChildFlags_Border);
	ImGui::Image(texture_target, ImGui::GetContentRegionAvail());
	ImGui::EndChild();
}

void BuilderPattern::on_render(SDL_Renderer* renderer)
{
	if (!chicken) return;
	
	SDL_SetRenderTarget(renderer, texture_target);
	SDL_SetRenderDrawColor(renderer, 15, 15, 15, 255);
	SDL_RenderClear(renderer);

	chicken->on_render(renderer);

	SDL_SetRenderTarget(renderer, nullptr);
